plugins {
  alias(deps.plugins.shadow)
  alias(deps.plugins.kotlin.jvm)
  alias(deps.plugins.ksp)
  alias(deps.plugins.grammarKitComposer)
  alias(deps.plugins.publish)
  alias(deps.plugins.dokka)
}

grammarKit {
  intellijRelease.set(deps.versions.idea)
}

dependencies {
  ksp deps.moshiCodegen

  api deps.mysqlJdbc

  compileOnly project(':sqldelight-compiler:dialect')
  compileOnly deps.intellij.core
  compileOnly deps.intellij.lang
  compileOnly deps.intellij.core.ui
  compileOnly deps.moshi

  testImplementation deps.intellij.core
  testImplementation deps.intellij.lang
  testImplementation deps.junit
  testImplementation deps.truth
  testImplementation project(':sqldelight-compiler:dialect')
  testImplementation deps.sqlPsiTestFixtures
}

apply from: "$rootDir/gradle/gradle-mvn-push.gradle"

tasks.getByName("shadowJar").configure {
  classifier = ''
  include "*.jar"
  include "app/cash/sqldelight/**"
  include "com/mysql/**"
  include 'META-INF/services/*'
}

tasks.jar.configure {
  // Prevents shadowJar (with classifier = '') and this task from writing to the same path.
  enabled = false
}

artifacts {
  runtimeOnly(shadowJar)
  archives(shadowJar)
}
