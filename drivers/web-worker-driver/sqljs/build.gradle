import java.nio.charset.StandardCharsets
import java.nio.file.Files

def packageJsonTask = tasks.register("writePackageJson") {
  def tmpLocation = layout.buildDirectory.file("tmp/package.json")
  outputs.file(tmpLocation)

  doLast {
    def content = new String(Files.readAllBytes(file("package.json").toPath()), StandardCharsets.UTF_8)
    content = content.replace("0.0.0", "${rootProject.version}")
    Files.write(tmpLocation.get().asFile.toPath(), content.getBytes(StandardCharsets.UTF_8))
  }
}

tasks.register("assemblePackage", Copy) {
  from packageJsonTask.map {it.outputs.files }
  from "sqljs.worker.js"
  from rootProject.file("LICENSE.txt")
  from rootProject.file("README.md")

  into layout.buildDirectory.file("package")
}
